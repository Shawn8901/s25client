INCLUDE("${CMAKE_CURRENT_LIST_DIR}/../Modules/CMakeMacroSetCCache.cmake")

# specify the cross compiler
SET_CCACHE(CMAKE_C_COMPILER i386-apple-darwin15-gcc)
SET_CCACHE(CMAKE_CXX_COMPILER i386-apple-darwin15-g++)
SET(CMAKE_RANLIB i386-apple-darwin15-ranlib CACHE STRING "" FORCE)
SET(CMAKE_LIPO i386-apple-darwin15-lipo CACHE STRING "" FORCE)
SET(CMAKE_INSTALL_NAME_TOOL i386-apple-darwin15-install_name_tool CACHE STRING "" FORCE)

SET(OSX1011_SDK "/usr/lib/apple/SDKs/MacOSX10.11.sdk")

# set SDK (use newest first)
MESSAGE(STATUS "Getting SDK. Old deployment target: ${CMAKE_OSX_DEPLOYMENT_TARGET}. Old sysroot: ${CMAKE_OSX_SYSROOT}")
SET(CMAKE_OSX_DEPLOYMENT_TARGET )
IF(EXISTS ${OSX1011_SDK})
	SET(CMAKE_OSX_SYSROOT ${OSX1011_SDK})
ELSE()
	MESSAGE(FATAL_ERROR "No OSX SDK found!")
ENDIF()
SET(CMAKE_OSX_SYSROOT ${CMAKE_OSX_SYSROOT} CACHE PATH "Path to OSX SDK")
MESSAGE(STATUS "Using OSX SDK at ${CMAKE_OSX_SYSROOT}")

#SET(CMAKE_SYSROOT ${CMAKE_OSX_SYSROOT})

SET(CMAKE_PREFIX_PATH ${CMAKE_OSX_SYSROOT})
SET(CMAKE_FIND_ROOT_PATH ${CMAKE_PREFIX_PATH})
SET(BOOST_ROOT ${CMAKE_PREFIX_PATH})

# search for programs in the build host directories
SET(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER)

# for libraries and headers in the target directories
SET(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY)
SET(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)

INCLUDE("${CMAKE_CURRENT_LIST_DIR}/../../libutil/cmake/Modules/CMakeMacroForceAddFlags.cmake")

# https://gcc.gnu.org/bugzilla/show_bug.cgi?id=78380
FORCE_ADD_FLAGS(CMAKE_C_FLAGS -fmath-errno)
FORCE_ADD_FLAGS(CMAKE_CXX_FLAGS -fmath-errno)

# enable libc++
#SET(LIBCXX_CXXFLAGS -nostdinc++ -isystem${CMAKE_OSX_SYSROOT}/usr/include/c++/v1 )
#SET(LIBCXX_LDFLAGS -nodefaultlibs -lc++ -lc++abi -lm -lc -static -lgcc -dynamic )
#FORCE_ADD_FLAGS(CMAKE_CXX_FLAGS ${LIBCXX_CXXFLAGS})
#FORCE_ADD_FLAGS(CMAKE_EXE_LINKER_FLAGS ${LIBCXX_LDFLAGS} )
#FORCE_ADD_FLAGS(CMAKE_MODULE_LINKER_FLAGS ${LIBCXX_LDFLAGS} )
#FORCE_ADD_FLAGS(CMAKE_SHARED_LINKER_FLAGS ${LIBCXX_LDFLAGS} )

# enable static libstdc++
SET(LIBSTDCXX_CFLAGS -static-libgcc)
SET(LIBSTDCXX_CXXFLAGS ${LIBSTDCXX_CFLAGS} -static-libstdc++)
SET(LIBSTDCXX_LDFLAGS ${LIBSTDCXX_CXXFLAGS})
FORCE_ADD_FLAGS(CMAKE_C_FLAGS ${LIBSTDCXX_CFLAGS} )
FORCE_ADD_FLAGS(CMAKE_CXX_FLAGS ${LIBSTDCXX_CXXFLAGS} )
FORCE_ADD_FLAGS(CMAKE_EXE_LINKER_FLAGS ${LIBSTDCXX_LDFLAGS} )
FORCE_ADD_FLAGS(CMAKE_MODULE_LINKER_FLAGS ${LIBSTDCXX_LDFLAGS} )
FORCE_ADD_FLAGS(CMAKE_SHARED_LINKER_FLAGS ${LIBSTDCXX_LDFLAGS} )
